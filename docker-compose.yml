services:
  api:
    build:
      context: .
      dockerfile: Dockerfile
    image: document-service-api:prod
    container_name: document-service-api
    env_file:
      - .env
    depends_on:
      arangodb:
        condition: service_started
      storage:
        condition: service_started
    command: uvicorn src.main:app --host 0.0.0.0 --port 8000
    networks:
      - thesis-net
    restart: unless-stopped
    ports:
      - "127.0.0.1:8005:8000"

  arangodb:
    image: arangodb:3.11
    container_name: document-arango
    env_file:
      - docker/arango.env
    volumes:
      - arango_data:/var/lib/arangodb3
    networks:
      - thesis-net
    restart: unless-stopped
    # Opcional: solo si necesitas acceso local desde el VPS (debug):
    ports:
      - "127.0.0.1:8529:8529"

  storage:
    image: minio/minio:latest
    container_name: document-storage
    env_file:
      - docker/minio.env
    volumes:
      - storage_data:/data
    command: server /data --console-address ":9001"
    networks:
      - thesis-net
    restart: unless-stopped
    # Solo local. API hablar√° con minio por red interna.
    ports:
      - "127.0.0.1:9005:9000"
      - "127.0.0.1:9007:9001"

volumes:
  arango_data:
  storage_data:

networks:
  thesis-net:
    external: true
